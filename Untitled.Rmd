---
title: "Web Scraping - UberEATS"
output:
  html_document:
    df_print: paged
---


```{r setup, include=FALSE}
# Load necessary libraries for web scraping, data manipulation, and formatting
library(rvest)
library(dplyr)
library(purrr)
library(knitr)
library(kableExtra)
library(lubridate)
library(magrittr)  # Load magrittr for the %>% operator

# Define the URL for the target website to extract data
url <- "https://www.trustpilot.com/review/ubereats.com"
page <- read_html(url)

# clean and convert date strings into Date objects
clean_dates <- function(dates) {
  cleaned_dates <- sub("Date of experience: ", "", dates)
  parsed_dates <- mdy(cleaned_dates)
  return(parsed_dates[!is.na(parsed_dates)])
}

```
 
This report provides a comprehensive guide on how to collect and analyze user reviews from the Trustpilot website, specifically focusing on reviews for Uber Eats. The report details the process of web scraping using R, including data extraction, transformation, and presentation. The report showcases how to efficiently retrieve and format essential components such as review texts, reviewer names, review dates, star ratings, and review titles.

### Reviews
```{r echo=FALSE,warning=FALSE}
# Extract the review text from the webpage
reviews_text <- page %>%
  html_elements(".styles_cardWrapper__LcCPA") %>%
  html_elements(".typography_body-l__KUYFJ") %>%
  html_text2()

# Convert extracted review text into a tibble format
reviews_df <- tibble(review = reviews_text)

# Display the first 6 rows of the review text in a formatted table
kable(head(reviews_df), format = "html", col.names = "Review") %>%
  kable_styling(bootstrap_options = c("striped", "responsive"),
                full_width = FALSE, position = "center")

```

### About Reviewer
```{r echo=FALSE, warning=FALSE}
# Extract the names of reviewers
reviewers <- page %>%
  html_elements(".styles_cardWrapper__LcCPA") %>%
  html_elements(".typography_heading-xxs__QKBS8") %>%
  html_text2()

# Convert extracted reviewer names into a tibble format
reviewers_df <- tibble(reviewer = reviewers)

# Display the first 6 rows of the reviewer names in a formatted table
kable(head(reviewers_df), format = "html", col.names = "Reviewer") %>%
  kable_styling(bootstrap_options = c("striped", "responsive"),
                full_width = FALSE, position = "center")


```

### Date
```{r echo=FALSE,warning=FALSE}
# Associated with each review
review_dates_raw <- page %>%
  html_elements(".styles_reviewContent__0Q2Tg .typography_body-m__xgxZ_") %>%
  html_text()

# Convert extracted dates
cleaned_review_dates <- clean_dates(review_dates_raw)
review_dates_df <- tibble(date = cleaned_review_dates)

# Display the first 6 rows of review dates in a formatted table
kable(head(review_dates_df), format = "html", col.names = "Date") %>%
  kable_styling(bootstrap_options = c("striped", "responsive"),
                full_width = FALSE, position = "center")

```

### Rating
```{r echo=FALSE,warning=FALSE}
# Extract the star ratings from the webpage
ratings_raw <- page %>%
  html_elements(".styles_reviewHeader__iU9Px") %>%
  html_attr("data-service-review-rating")

# Convert extracted ratings into numeric values
ratings_numeric <- as.numeric(ratings_raw)
ratings_df <- tibble(rating = ratings_numeric)

# Display the first 6 rows of star ratings in a formatted table with left-aligned content
kable(head(ratings_df), format = "html", col.names = "Rating") %>%
  kable_styling(bootstrap_options = c("striped", "responsive"),
                full_width = FALSE, position = "left") %>%
  column_spec(1, width = "10em", extra_css = "text-align: left;")


```

## Combining the Elements
```{r echo=FALSE,warning=FALSE}
# Scrape a single page
scrape_single_page <- function(page_url) {
  page <- read_html(page_url)
  
  # Extract various components: reviews, reviewers, dates, ratings, and titles
  reviews <- page %>%
    html_elements(".styles_cardWrapper__LcCPA .typography_body-l__KUYFJ") %>%
    html_text2()
  
  reviewers <- page %>%
    html_elements(".styles_cardWrapper__LcCPA .typography_heading-xxs__QKBS8") %>%
    html_text2()
  
  review_dates <- clean_dates(
    page %>% html_elements(".styles_reviewContent__0Q2Tg .typography_body-m__xgxZ_") %>%
      html_text()
  )
  
  ratings <- as.numeric(page %>%
    html_elements(".styles_reviewHeader__iU9Px") %>%
    html_attr("data-service-review-rating"))
  
  review_titles <- page %>%
    html_elements(".styles_reviewContentwrapper__zH_9M .typography_heading-s__f7029") %>%
    html_text2()
  
  # Create a tibble with all data
  tibble(
    title = review_titles,
    date = review_dates,
    reviewer = reviewers,
    rating = ratings,
    review = reviews
  )
}

# Scraping 5 pages
all_pages_data <- map_df(1:5, ~ scrape_single_page(paste0(url, "?page=", .x)))

# Display the combined data
kable(all_pages_data, format = "html") %>%
  kable_styling(bootstrap_options = c("striped", "responsive"),
                full_width = FALSE, position = "center") %>%
  column_spec(1, width = "15em") %>%
  column_spec(2, width = "12em") %>%
  column_spec(3, width = "15em") %>%
  column_spec(4, width = "5em") %>%
  column_spec(5, width = "40em")

```